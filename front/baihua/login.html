<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>登录-百花社区</title>
    <link rel="stylesheet" href="css/common.css">
</head>
<body>
<header>
    <div class="header-line"></div>
</header>
<div class="content" id="app">
    <h1 class="content-title">欢迎使用百花社区养老服务管理系统</h1>
    <div class="content-form">
        <div id="form-wrap">
            <div id="change_margin_1">
                <input v-model="name" @click="clearErrorMsg" class="user" id="account" type="text" name="user"
                       placeholder="请输入账号">
            </div>
            <p id="remind_1">{{errorMsg}}</p>
            <div id="change_margin_2">
                <input v-model="password" @click="clearErrorMsg" id="password" class="password" type="password"
                       name="password"
                       placeholder="请输入密码">
            </div>
            <!-- input的value为空时弹出提醒 -->
            <div id="change_margin_3">
                <div v-on:click="login">登录</div>
            </div>
        </div>
    </div>
    <div class="content-login-description">没有账户？</div>
    <div><a class="content-login-link" href="signup.html">注册</a></div>
</div>
<script src="js/vue.js"></script>
<script src="js/axios.js"></script>
<script src="js/commons.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            name: null,
            password: null,
            errorMsg: null
        },
        methods: {
            login: function () {
                //http://localhost
                var that = this;
                var account = this.name;
                var passwd = this.password;
                doRequest("/api/account/login", {
                    account: account,
                    password: passwd
                }, function (data) {
                    console.log(data);
                    //设置缓存
                    setCookie("user", data);
                    window.location.href = "index.html";
                }, "post", function (ret) {
                    if (!ret) {
                        alert("登陆失败");
                        return;
                    }
                    let msg = ret.msg || "登陆失败";
                    that.errorMsg = msg;
                });
            },
            clearErrorMsg: function () {
                this.errorMsg = null;
            }

        }
    })
</script>
</body>
</html>